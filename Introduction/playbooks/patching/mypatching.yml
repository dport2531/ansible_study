---
- hosts: webserver
  tasks:
    - name: Verify App/Database status
      shell: if ps -eaf| egrep 'httpd' | grep -v grep > /dev/null; then echo 'Process is running'; else echo 'Process is not running'; fi
      ignore_errors: true
      register: appr_proc_check
    - debug: msg="{{  appr_proc_check.stdout }}" 
    - name: Decision point to start patching
      fail:
             msg="{{ inventory_hostname }} having running application, please stop first and attempt patching"  
      when:  appr_proc_check.stdout == 'Process is running'  
    - name: Copy Kernel Repo file 
      copy:
        src: /ansible_study/Introduction/playbooks/patching/kernel.repo
        dest: /etc/yum.repos.d
    - name: Current Kernel Version
      shell: uname -r
      register: curr_ker
    - name: Initiating Patching
      yum: 
        name=kernel 
        state=latest
      register: yum_update
    - debug; msg="kernel has been updated"
      when: yum_update.rc == 0    


